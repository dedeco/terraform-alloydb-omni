{"payload":{"allShortcutsEnabled":false,"fileTree":{"":{"items":[{"name":"LICENSE","path":"LICENSE","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"},{"name":"omni_start.sh","path":"omni_start.sh","contentType":"file"}],"totalCount":3}},"fileTreeProcessingTime":1.986153,"foldersToFetch":[],"reducedMotionEnabled":null,"repo":{"id":695320788,"defaultBranch":"main","name":"alloydb_omni_start","ownerLogin":"GabeWeiss","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2023-09-22T21:10:45.000Z","ownerAvatar":"https://avatars.githubusercontent.com/u/20767902?v=4","public":true,"private":false,"isOrgOwned":false},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"main","listCacheKey":"v0:1695417047.1564212","canEdit":false,"refType":"branch","currentOid":"b9401f893e5792df4b2032fe1ecb23f15870f0ca"},"path":"omni_start.sh","currentUser":null,"blob":{"rawLines":["### Set up some temp variables to use in our script","","# This variables represents the size of the added attached disk we specified","# at VM creation.  Whatever you specified at creation time should match this variable","# NOTE: If you happen to create an attached disk that's the same size as the boot","# disk (don't do that) then this all will fail.","DISK_SIZE=200G","# This fetches our attached disk","DISK_NAME=`sudo lsblk | grep -Eo \"^[[:space:]]*[a-z0-9]+.*$DISK_SIZE\" | grep -Eo \"^[[:space:]]*[a-z0-9]+\"`","# Because the disk name can change each time, we need to fetch the UUID to use in /etc/fstab","DISK_UUID=`sudo blkid /dev/$DISK_NAME | grep -Eo '=\"[a-z0-9\\-]+\" ' | grep -Eo \"[a-z0-9\\-]+\"`","# A default directory to store the database data itself. If you don't want it in this location,","# you can change this directory. Note here that GCE startup scripts run as root","# and the $USER variable is not yet defined, so be careful.","OMNI_DATA_DIR=/var/lib/alloydbomni/data","","# Formatting our new drive","sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/$DISK_NAME","# Creating our mount point.","sudo mkdir -p $OMNI_DATA_DIR","# Mount the disk and make it writeable","sudo mount -o discard,defaults /dev/$DISK_NAME $OMNI_DATA_DIR","sudo chmod a+w $OMNI_DATA_DIR","# Backup the fstab file just in case we mess something up, then write an entry for our","# new disk so it mounts on startup. If you want to allow the machine to come up even if","# the disk isn't available for whatever reason, you'll want to add 'nofail' to the options","# right after discard and defaults, so that piece reads: 'discard,defaults,nofail'","sudo cp /etc/fstab /etc/fstab.backup","echo \"UUID=$DISK_UUID $OMNI_DATA_DIR ext4 discard,defaults 0 2\" | sudo tee -a /etc/fstab","# Because of timing of all of this, an occasional panic will cause a lost+found directory to","# be created, but not used. Intentionally, the rm does NOT use the m flag, so if the directory","# isn't empty (something really did go wrong) that will fail and stop the script at this point","sudo rm -r lost+found","","### Time to start installing things!","sudo apt-get update","# First up need to install the requirements for installing Docker","sudo apt-get -y install ca-certificates curl gnupg lsb-release","sudo mkdir -m 0755 -p /etc/apt/keyrings","curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg","echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null","# Next up, time to install Docker itself","sudo apt-get update","sudo apt-get -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin","curl https://us-apt.pkg.dev/doc/repo-signing-key.gpg | sudo apt-key add -","sudo apt update","echo \"deb https://us-apt.pkg.dev/projects/alloydb-omni alloydb-omni-apt main\" | sudo tee -a /etc/apt/sources.list.d/artifact-registry.list","sudo apt update","# And now we're installing AlloyDB Omni itself","sudo apt-get -y install alloydb-cli","sudo alloydb database-server install --data-dir=$OMNI_DATA_DIR","sudo alloydb database-server start","# Last, installing the psql client so we can easily interact with our Omni server","sudo apt-get -y install postgresql-client","# Now you should be able to connect to Omni with 'psql -h localhost -U postgres'","# Note that there is no password set by default, so be sure first thing you do is","# set a password for the postgres user."],"stylingDirectives":[[{"start":0,"end":51,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[{"start":0,"end":76,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":85,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":81,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":47,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[{"start":0,"end":32,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":10,"end":106,"cssClass":"pl-s"},{"start":10,"end":11,"cssClass":"pl-pds"},{"start":22,"end":23,"cssClass":"pl-k"},{"start":33,"end":69,"cssClass":"pl-s"},{"start":33,"end":34,"cssClass":"pl-pds"},{"start":58,"end":68,"cssClass":"pl-smi"},{"start":68,"end":69,"cssClass":"pl-pds"},{"start":70,"end":71,"cssClass":"pl-k"},{"start":81,"end":105,"cssClass":"pl-s"},{"start":81,"end":82,"cssClass":"pl-pds"},{"start":104,"end":105,"cssClass":"pl-pds"},{"start":105,"end":106,"cssClass":"pl-pds"}],[{"start":0,"end":92,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":10,"end":92,"cssClass":"pl-s"},{"start":10,"end":11,"cssClass":"pl-pds"},{"start":27,"end":37,"cssClass":"pl-smi"},{"start":38,"end":39,"cssClass":"pl-k"},{"start":49,"end":66,"cssClass":"pl-s"},{"start":49,"end":50,"cssClass":"pl-pds"},{"start":65,"end":66,"cssClass":"pl-pds"},{"start":67,"end":68,"cssClass":"pl-k"},{"start":78,"end":91,"cssClass":"pl-s"},{"start":78,"end":79,"cssClass":"pl-pds"},{"start":90,"end":91,"cssClass":"pl-pds"},{"start":91,"end":92,"cssClass":"pl-pds"}],[{"start":0,"end":95,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":79,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":59,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[],[{"start":0,"end":26,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":75,"end":85,"cssClass":"pl-smi"}],[{"start":0,"end":27,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":14,"end":28,"cssClass":"pl-smi"}],[{"start":0,"end":38,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":36,"end":46,"cssClass":"pl-smi"},{"start":47,"end":61,"cssClass":"pl-smi"}],[{"start":15,"end":29,"cssClass":"pl-smi"}],[{"start":0,"end":86,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":87,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":90,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":82,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[{"start":0,"end":4,"cssClass":"pl-c1"},{"start":5,"end":63,"cssClass":"pl-s"},{"start":5,"end":6,"cssClass":"pl-pds"},{"start":11,"end":21,"cssClass":"pl-smi"},{"start":22,"end":36,"cssClass":"pl-smi"},{"start":62,"end":63,"cssClass":"pl-pds"},{"start":64,"end":65,"cssClass":"pl-k"}],[{"start":0,"end":92,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":94,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":94,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[],[{"start":0,"end":36,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[{"start":0,"end":65,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[],[{"start":56,"end":57,"cssClass":"pl-k"}],[{"start":0,"end":4,"cssClass":"pl-c1"},{"start":5,"end":152,"cssClass":"pl-s"},{"start":5,"end":6,"cssClass":"pl-pds"},{"start":16,"end":44,"cssClass":"pl-s"},{"start":16,"end":18,"cssClass":"pl-pds"},{"start":43,"end":44,"cssClass":"pl-pds"},{"start":126,"end":144,"cssClass":"pl-s"},{"start":126,"end":128,"cssClass":"pl-pds"},{"start":143,"end":144,"cssClass":"pl-pds"},{"start":151,"end":152,"cssClass":"pl-pds"},{"start":153,"end":154,"cssClass":"pl-k"},{"start":200,"end":201,"cssClass":"pl-k"}],[{"start":0,"end":40,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[],[{"start":53,"end":54,"cssClass":"pl-k"}],[],[{"start":0,"end":4,"cssClass":"pl-c1"},{"start":5,"end":77,"cssClass":"pl-s"},{"start":5,"end":6,"cssClass":"pl-pds"},{"start":76,"end":77,"cssClass":"pl-pds"},{"start":78,"end":79,"cssClass":"pl-k"}],[],[{"start":0,"end":46,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[{"start":48,"end":62,"cssClass":"pl-smi"}],[],[{"start":0,"end":81,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[],[{"start":0,"end":80,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":81,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}],[{"start":0,"end":39,"cssClass":"pl-c"},{"start":0,"end":1,"cssClass":"pl-c"}]],"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/GabeWeiss/alloydb_omni_start/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":null,"repoAlertsPath":"/GabeWeiss/alloydb_omni_start/security/dependabot","repoSecurityAndAnalysisPath":"/GabeWeiss/alloydb_omni_start/settings/security_analysis","repoOwnerIsOrg":false,"currentUserCanAdminRepo":false},"displayName":"omni_start.sh","displayUrl":"https://github.com/GabeWeiss/alloydb_omni_start/blob/main/omni_start.sh?raw=true","headerInfo":{"blobSize":"3.43 KB","deleteInfo":{"deleteTooltip":"You must be signed in to make or propose changes"},"editInfo":{"editTooltip":"You must be signed in to make or propose changes"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"25dbb60","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2FGabeWeiss%2Falloydb_omni_start%2Fblob%2Fmain%2Fomni_start.sh","isCSV":false,"isRichtext":false,"toc":null,"lineInfo":{"truncatedLoc":"57","truncatedSloc":"54"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Shell","languageID":346,"large":false,"loggedIn":false,"newDiscussionPath":"/GabeWeiss/alloydb_omni_start/discussions/new","newIssuePath":"/GabeWeiss/alloydb_omni_start/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/GabeWeiss/alloydb_omni_start/blob/main/omni_start.sh","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/GabeWeiss/alloydb_omni_start/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"rawBlobUrl":"https://github.com/GabeWeiss/alloydb_omni_start/raw/main/omni_start.sh","renderImageOrRaw":false,"richText":null,"renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"GabeWeiss","repoName":"alloydb_omni_start","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timed_out":false,"not_analyzed":false,"symbols":[]}},"copilotInfo":null,"copilotAccessAllowed":false,"csrf_tokens":{"/GabeWeiss/alloydb_omni_start/branches":{"post":"ozRDOLsrZfrWsjpdT3HJ495w4ZLAxmftqjN9c4NQgsi-YW6utTWWzogyUnQZ5uneaOCpmJJklYaM4gYg2NFnjw"},"/repos/preferences":{"post":"tONyHciO3KgYyNySd0FFfDABvLNTBecn1TSWJPooyEc6jAFjlN292HfwfioGkgp3fEvrr1V8rfPcKECDCZR6sg"}}},"title":"alloydb_omni_start/omni_start.sh at main Â· GabeWeiss/alloydb_omni_start"}